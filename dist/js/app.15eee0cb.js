(function(t){function e(e){for(var o,i,a=e[0],c=e[1],d=e[2],u=0,h=[];u<a.length;u++)i=a[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&h.push(r[i][0]),r[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);l&&l(e);while(h.length)h.shift()();return s.push.apply(s,d||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(s.splice(e--,1),t=i(i.s=n[0]))}return t}var o={},r={app:0},s=[];function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var d=0;d<a.length;d++)e(a[d]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var o=n("64a9"),r=n.n(o);r.a},1:function(t,e){},"2f4e":function(t,e,n){},"31cd":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var o=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[0==t.step?n("crash-page",{staticClass:"content",on:{got_papers:t.draw_graph}}):t._e(),1==t.step?n("graph-overlay",{attrs:{socket:t.socket,nodes:t.data},on:{search:t.search}}):t._e()],1)},s=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",[n("b-row",{staticClass:"title align-items-center"},[n("b-col",[n("h3",[t._v("\n        Yggdrasil\n      ")])])],1),n("b-row",{attrs:{"align-h":"center"}},[n("b-col",{attrs:{sm:"7"}},[n("b-row",{attrs:{"align-v":"center","align-h":"center"}},[n("font-awesome-icon",{staticClass:"custom-btn",attrs:{icon:"search"},on:{click:t.search}}),n("b-col",{attrs:{cols:"10"}},[n("b-input",{staticClass:"input-request",attrs:{placeholder:"rechercher par DOI, mot-clés, auteur...",icon:"search",label:"mots-clés, DOI, auteur..."},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.request,callback:function(e){t.request=e},expression:"request"}})],1)],1),n("b-row",{staticClass:"query_type-select",attrs:{"align-h":"center","align-v":"center"}},[t._v("\n        Je recherche\n        "),n("b-col",{attrs:{cols:"7"}},[n("vue-multiselect",{attrs:{"allow-empty":!1,label:"name","track-by":"code",options:t.options},model:{value:t.query_type,callback:function(e){t.query_type=e},expression:"query_type"}})],1)],1),t.loading?n("b-row",{staticClass:"req_spinner",attrs:{"align-h":"center"}},[n("b-spinner")],1):t._e()],1)],1)],1)},a=[],c={name:"crash-page",data:function(){return{socket:null,loading:!1,request:"",author:!1,query_type:{code:"paper_id",name:"un papier spécifique "},options:[{code:"author",name:"un auteur"},{code:"key_words",name:"des mot-clés"},{code:"paper_id",name:"un papier spécifique"}]}},components:{},methods:{connect:function(){this.socket=o["default"].prototype.$socketIO.connect("http://localhost:3000"),this.socket.on("connect",(function(){console.log("connected")}))},search:function(){var t=this,e=this;this.loading=!0;var n="http://api.semanticscholar.org/v1/author/38087946";n="http://localhost:3000/"+this.query_type.code,this.$.get(n,{params:{paper_id:e.request,socket_id:e.socket.id}}).then((function(e){if(console.log("success ? ",e.data),t.loading=!1,"error"in e.data)throw t.$bvToast.toast("Le papier n'a pas été trouvé",{title:"Erreur",autoHideDelay:2e3}),"Paper not found";t.$emit("got_papers",{socket:t.socket})})).catch((function(e){console.log(e),t.loading=!1}))}},mounted:function(){this.connect()}},d=c,l=(n("d887"),n("2877")),u=Object(l["a"])(d,i,a,!1,null,"21168dba",null),h=u.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{style:{height:"100vh",width:"100vw"},attrs:{id:"viz"}},[n("g",{attrs:{id:"container"}},[n("g",{staticClass:"links",attrs:{id:"g_links"}},[null!==t.graph?[t._l(t.graph.links,(function(e){return t.gradient_links?n("linearGradient",{key:e.index,attrs:{id:"gradient_"+e.index,x1:t.fixna(e.source.x),y1:e.source.y,x2:e.target.x,y2:e.target.y,gradientUnits:"userSpaceOnUse"}},[n("stop",{attrs:{"stop-color":"white",offset:"0"}}),n("stop",{attrs:{"stop-color":e.source.favorite||e.target.favorite?t.greenColor:t.mainColor,offset:"1"}})],1):t._e()})),t._l(t.graph.links,(function(e){return n("line",{style:{opacit:.5},attrs:{stroke:t.gradient_links?"url(#gradient_"+e.index+")":t.mainColor,"stroke-width":"1.5px",x1:t.fixna(e.source.x),y1:e.source.y,x2:e.target.x,y2:e.target.y}})}))]:t._e()],2),n("g",{staticClass:"nodes",attrs:{id:"g_nodes"}},[null!==t.graph?[t._l(t.graph.nodes,(function(e){return n("circle",{key:e.paperId,staticClass:"circle",attrs:{fill:"white",stroke:e.favorite?t.greenColor:t.mainColor,"stroke-width":"2px",id:e.paperId,r:t.computeRadius(e.citations.length),cx:"fx"in e&&null!==e.fx?e.fx:t.fixna(e.x),cy:"fy"in e&&null!==e.fy?e.fy:t.fixna(e.y)},on:{mouseenter:function(n){return t.focus(e)},mouseleave:t.unfocus}})})),t._l(t.graph.nodes,(function(e){return t.disp_titles?n("text",{attrs:{id:"title_"+e.id,lengthAdjust:"spacingAndGlyphs",textLength:4*t.computeRadius(e.citations.length),fill:e.favorite?t.greenColor:t.mainColor,x:e.x-2*t.computeRadius(e.citations.length),y:e.y+t.computeRadius(e.citations.length)+25}},[t._v(t._s(e.title.slice(0,Math.min(e.title.length,t.computeRadius(e.citations.length)/2)))+"...")]):t._e()}))]:t._e()],2)])])},f=[],_=n("75fc"),g=(n("7514"),n("ac6a"),n("456d"),n("c5f6"),n("5698")),v={name:"tree-v2",props:{cdpScore_threshold:{type:Number,default:5},distance_nodes:{type:Number,default:100},node_charge:{type:Number,default:-6e3},graph_original:Object,adjlist:Object,disp_titles:Boolean,gradient_links:Boolean},components:{},mounted:function(){this.graph=this.graph_original,this.init()},data:function(){return{current_node:null,center_x:950,center_y:500,drawn:!1,graphLayout:null,graph:null,nodeDiameter:200}},computed:{node_settings:function(){return{diameter:this.nodeDiameter}}},watch:{adjlist:function(){console.log("adjlist refreshed")},node_charge:function(){this.graphLayout.alpha(.03).restart()},distance_nodes:function(){this.graphLayout.alpha(.03).restart()}},methods:{computeThales:function(t,e,n){var o=[t[0]-e[0],t[1]-e[1]],r=Math.pow(Math.pow(o[0],2)+Math.pow(o[1],2),.5);return{d:r,vector:o}},computeArrowX:function(t,e,n){var o=this.computeThales(t,e,n);return t[0]-(this.computeRadius(n)+5)*o.vector[0]/o.d},computeArrowY:function(t,e,n){var o=this.computeThales(t,e,n);return t[1]-(this.computeRadius(n)+5)*o.vector[1]/o.d},correctPos:function(t){return t<0||!isFinite(t)?800:t},copyNestedObject:function(t){var e,n=this;switch(t){case null:return null;case void 0:return}n=this;var o=t.constructor;switch(o){case Number:return t;case Boolean:return t;case String:return t;case Array:e=[];for(var r=0;r<t.length;r++)e.push(n.copyNestedObject(t[r]));return e;case Object:e={};for(var s=Object.keys(t),i=0;i<s.length;i++)e[s[i]]=n.copyNestedObject(t[s[i]]);return e}},ticked:function(){var t=this,e=this;function n(t){g["b"].sourceEvent.stopPropagation(),e.graphLayout.alpha(.03).restart()}function r(t){e.graph.nodes.find((function(e){return e.id==t.id})).fx=g["b"].x,e.graph.nodes.find((function(e){return e.id==t.id})).fy=g["b"].y}function s(t){e.graph.nodes.find((function(e){return e.id==t.id})).fx=null,e.graph.nodes.find((function(e){return e.id==t.id})).fy=null}this.graphLayout.nodes(e.graph.nodes),this.graphLayout.force("charge",g["f"]().strength(e.node_charge)).force("collide",g["d"](e.distance_nodes)).force("link",g["e"](this.graph.links).id((function(t){return t.id})).distance(e.distance_nodes).strength(1)),this.graph.links.forEach((function(n,r){o["default"].set(e.graph.links,r,Object.assign({},n)),o["default"].set(e.graph.links[r],"source",t.graph.nodes.find((function(t){return t.paperId==n.source.paperId}))),o["default"].set(e.graph.links[r],"target",t.graph.nodes.find((function(t){return t.paperId==n.target.paperId})))})),this.graph.nodes.forEach((function(t,n){o["default"].set(e.graph.nodes,n,Object.assign({},t))}));g["m"](".circle").data(this.graph.nodes).call(g["a"]().on("start",n).on("drag",r).on("end",s))},init:function(){if(!this.drawn){this.drawn=!0;var t=this,e=g["l"]("svg"),n=1920,o=1080,r=(g["j"](g["k"]),this.graph),s=Object(_["a"])(r.links),i=Object(_["a"])(r.nodes);this.graphLayout=g["g"](i).force("charge",g["f"]().strength(t.node_charge)).force("x",g["h"](n/2).strength(1)).force("y",g["i"](o/2).strength(1)).force("collide",g["d"](t.distance_nodes)).force("center",g["c"](n/2,o/2)).force("link",g["e"](s).id((function(t){return t.id})).distance(t.distance_nodes).strength(1)).on("tick",t.ticked).alpha(.03).alphaDecay(.002);e=g["l"]("#viz");var a=g["l"]("#container");e.call(g["n"]().scaleExtent([.1,4]).on("zoom",(function(){a.attr("transform",g["b"].transform)})))}},fixna:function(t){return isFinite(t)?t:600},computeRadius:function(t){return 0==t?20:20+5*Math.pow(t,1/3)},neigh:function(t,e){return t==e||this.adjlist[t+"-"+e]},focus:function(t){this.$emit("hover_node",t),this.current_node=t;var e=this,n=g["m"](".circle").data(e.graph.nodes),o=g["m"]("line").data(e.graph.links),r=g["m"]("text").data(e.graph.nodes),s=g["m"](".pointer").data(e.graph.links),i=t.id;n.style("opacity",(function(t){return e.neigh(i,t.id)?1:.1})),r.style("opacity",(function(t){return e.neigh(i,t.id)?1:.1})),o.style("opacity",(function(t){return t.source.id==i||t.target.id==i?1:.1})),s.style("opacity",(function(t){return t.source.id==i||t.target.id==i?1:0}))},unfocus:function(){this.current_node=null;var t=g["m"](".circle"),e=g["m"]("line"),n=g["m"]("text"),o=g["m"](".pointer");t.style("opacity",1),e.style("opacity",1),n.style("opacity",1),o.style("opacity",1)}}},m=v,y=(n("cb2b"),Object(l["a"])(m,p,f,!1,null,"f1dd5712",null)),b=y.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("custom-tooltip",{directives:[{name:"show",rawName:"v-show",value:t.hover_node,expression:"hover_node"}],attrs:{node_settings:t.node_settings,position:t.hovered_node_location,id:"infoBoxHolder",node:this.hovered_node}}),n("svg",{style:{height:"100vh",width:"100vw"},attrs:{id:"viz"}},[n("g",{attrs:{id:"container"}},[n("g",{staticClass:"links",attrs:{id:"g_links"}}),n("g",{staticClass:"nodes",attrs:{id:"g_nodes"}})])]),n("div",{staticClass:"custom-container"},[n("b-row",{attrs:{"align-h":"center"}},[n("b-col",{attrs:{cols:"auto"}},[t._v("\n        Cliquer "),n("span",{staticClass:"link",on:{click:t.search}},[t._v("ici")]),t._v(" pour relancer une recherche\n        "),n("br"),t._v("\n        Cliquer "),n("span",{staticClass:"link",on:{click:t.addNode}},[t._v("ici")]),t._v(" pour ajouter un noeud\n        "),n("br"),t._v("\n        Il y a "+t._s(t.eventual_nodes.length)+" noeuds et "+t._s(t.eventual_links.length)+" liens\n      ")]),n("b-col",{staticClass:"text-left",attrs:{cols:"auto"}},[t._v("\n        Charge : "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.node_charge,expression:"node_charge"}],staticClass:"slider",attrs:{type:"range",min:"-100000",max:"0",id:"myRange"},domProps:{value:t.node_charge},on:{__r:function(e){t.node_charge=e.target.value}}}),t._v(t._s(t.node_charge)+"\n        "),n("br"),t._v("\n        Cdp threshold : "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.cdpScore_threshold,expression:"cdpScore_threshold"}],staticClass:"slider",attrs:{type:"range",min:"0",max:"400"},domProps:{value:t.cdpScore_threshold},on:{change:t.updateNodes,__r:function(e){t.cdpScore_threshold=e.target.value}}}),t._v(t._s(t.cdpScore_threshold)+"\n        "),n("br"),t._v("\n        Distance : "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.distance_nodes,expression:"distance_nodes"}],staticClass:"slider",attrs:{type:"range",min:"0",max:"1000"},domProps:{value:t.distance_nodes},on:{change:t.refresh,__r:function(e){t.distance_nodes=e.target.value}}}),t._v(t._s(t.distance_nodes)+"\n      ")]),null!==t.graphLayout?[t._v('\n        "'+t._s(t.graphLayout.force("link"))+"\n      ")]:t._e()],2)],1)],1)},x=[],w=(n("6762"),n("2fdb"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return null!==t.node?n("div",{style:t.positionStyleCursor},[n("div",{style:t.sizingStyle,attrs:{id:"infoBox"}},[n("h5",[n("font-awesome-icon",{staticClass:"svg_icon star",style:t.star_style,attrs:{icon:"star"},on:{click:t.setFavorite}}),t._v("\n      "+t._s(t.node.title)+"\n    ")],1),n("font-awesome-icon",{staticClass:"svg_icon star",attrs:{color:t.redColor,icon:"trash"},on:{click:t.trashNode}}),t._v("\n      supprimer ce noeud du graph\n    "),n("br"),n("span",{staticClass:"full_text"},[n("b",[t._v("\n        Abstract :\n      ")]),t._v("\n      "+t._s(t.node.abstract)+"\n    ")]),n("br"),n("b",[t._v("\n      Year :\n    ")]),t._v("\n    "+t._s(t.node.year)+"\n    "),n("br"),n("b",[t._v("\n      Cited by :\n    ")]),"citations"in t.node?[t._v("\n      "+t._s(t.node.citations.length)+"\n    ")]:t._e(),n("br"),n("b",[t._v("\n      CdP Score :\n    ")]),t._v("\n    "+t._s(t.node.cdpScore)+"\n    "),n("br"),n("b",[t._v("\n      Appeared in :\n    ")]),""!==t.node.venue?[t._v("\n      "+t._s(t.node.venue)+"\n    ")]:[t._v("\n      N/A\n    ")],n("br"),n("p",{staticClass:"url"},[n("b",[t._v("\n        URL :\n      ")]),n("a",{attrs:{href:t.node.url}},[t._v(t._s(t.node.url))])])],2)]):t._e()}),C=[],j={name:"custom-tooltip",props:{position:{type:Object,default:{F:-25,G:75}},node_settings:Object,tooltipWidth:{type:String,default:"25vw"},node:{type:Object,default:{title:"",abstract:""}}},data:function(){return{total_width:0}},computed:{star_style:function(){var t={};return t=this.node.favorite?{color:this.greenColor}:{opacity:.2},t},arrowStyle:function(){return this.position.F+this.node_settings.diameter/2>this.total_width/2?{boxShadow:"5px -5px 10px 0.1px rgba(10,10,10,0.1)",left:.2*this.total_width-10+"px"}:{boxShadow:"-5px 5px 10px 0.1px rgba(10,10,10,0.1)",left:"-10px"}},sizingStyle:function(){return{width:this.tooltipWidth}},positionStyleCursor:function(){return this.position.F+this.node_settings.diameter/2>this.total_width/2?{left:this.position.F-.2*this.total_width-50+"px",top:this.position.G-65+"px"}:{left:this.position.F+50+"px",top:this.position.G-65+"px"}},positionStyleNode:function(){return this.position.F+this.node_settings.diameter/2>this.total_width/2?{left:this.position.F-.2*this.total_width-30+"px",top:this.position.G+"px"}:{left:this.position.F+this.node_settings.diameter+30+"px",top:this.position.G+"px"}}},methods:{trashNode:function(){this.$emit("trash")},setFavorite:function(){this.$emit("favorite",!this.node.favorite)}},mounted:function(){var t=this;this.total_width=window.innerWidth,window.addEventListener("resize",(function(){t.total_width=window.innerWidth}))},watch:{node:function(){console.log("node refreshed")}}},O=j,S=(n("dafa"),Object(l["a"])(O,w,C,!1,null,"7f9c8f5d",null)),I=S.exports,N={name:"tree-d3",props:{nodes:Array,socket:Object},components:{CustomTooltip:I},mounted:function(){var t=this;console.log("Launching stuff"),this.nodes.forEach((function(e){t.addNode(e)})),setTimeout(this.init,3e3),this.socket.on("done",(function(){console.log("RECEIVED ALL"),t.init()})),this.socket.on("new_node",(function(e){t.addNode(e)}))},data:function(){return{current_x:0,node_charge:-5e3,drawn:!1,cursor:0,total_nodes:[],distance_nodes:50,graphLayout:null,total_links:[],total_links_2:[],hovered_node:null,hovered_node_location:{F:-25,G:100},diagram:null,total_width:0,hover_node:!1,nodes_limit:2,mainColor:"#2c3e50",lightColor:"rgb(150,150,150)",redColor:"#ff6a6a",greenColor:"#41b883",nodeDiameter:200,current_node:null,cdpScore_threshold:5,eventual_links:[],eventual_nodes:[]}},computed:{graph:function(){return{nodes:Object(_["a"])(this.eventual_nodes),links:Object(_["a"])(this.eventual_links)}},node_settings:function(){return{diameter:this.nodeDiameter}},links_checker:function(){return this.total_links.filter((function(t){return t.source.constructor===String&&t.target.constructor===String})).length}},watch:{node_charge:function(){console.log("force changed")}},methods:{computeEventual_nodes:function(){var t=this,e=this;this.eventual_nodes=e.total_nodes.filter((function(e){return e.cdpScore>=t.cdpScore_threshold}))},computeEventual_links:function(){var t=this;this.eventual_links=this.copyNestedObject(t.total_links).filter((function(e){return t.eventual_nodes.map((function(t){return t.paperId})).includes(e.source)&&t.eventual_nodes.map((function(t){return t.paperId})).includes(e.target)}))},copyNestedObject:function t(e){switch(e){case null:return null;case void 0:return}var n=e.constructor;switch(n){case Number:return e;case Boolean:return e;case String:return e;case Array:return e.map((function(e){return t(e)}));case Object:return Object.keys(e).map((function(n){e[n]=t(e[n])})),e}},updateNodes:function(){this.drawn=!1,this.init()},updateLinks:function(){this.computeEventual_links();var t=this,e=g["m"]("line.link").data(t.graph.links);e.enter().append("line").attr("class","link").attr("stroke","#ddd").attr("stroke-opacity",.8).attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),e.exit().remove(),this.total_links=Object(_["a"])(this.total_links_2)},refresh:function(){console.log("CDP CONSTRAINT CHANGED")},slowAddNode:function(t){console.log("Adding ",this.cursor);var e=this;100==this.cursor&&this.init(),this.cursor<this.total_nodes.length&&this.addNode(this.total_nodes[this.cursor]),this.cursor+=1,this.cursor<this.nodes_limit&&setTimeout(e.slowAddNode.bind(null,t),t)},search:function(){this.$emit("search")},addNode:function(t){var e=this;t.id=t.paperId,t.color="white",t.references.forEach((function(n){if(e.total_nodes.map((function(t){return t.id})).includes(n.paperId)){var o={source:n.paperId,target:t.paperId,value:1},r={source:n.paperId,target:t.paperId,value:1};e.total_links.includes(o)||(e.total_links.push(o),e.total_links_2.push(r))}})),t.citations.forEach((function(n){if(e.total_nodes.map((function(t){return t.key})).includes(n.paperId)){var o={source:t.paperId,target:n.paperId,value:1},r={source:t.paperId,target:n.paperId,value:1};e.total_links.includes(o)||(e.total_links.push(o),e.total_links_2.push(r))}})),t.id=t.paperId,t.group=Math.round(t.citations.length/100),e.total_nodes.map((function(t){return t.paperId})).includes(t.paperId)||null==t.paperId||void 0===t.paperId||e.total_nodes.push(t)},init:function(){if(console.log("Hey"),!this.drawn){this.drawn=!0;var t=this,e=g["l"]("svg"),n=1920,o=1080,r=g["j"](g["k"]);this.computeEventual_nodes(),this.computeEventual_links(),console.log("links : ",this.eventual_links),console.log("nodes : ",this.eventual_nodes);var s=this.graph;console.log(s);var i={nodes:[],links:[]};s.nodes.forEach((function(t,e){i.nodes.push({node:t}),i.nodes.push({node:t}),i.links.push({source:2*e,target:2*e+1})}));var a=Object(_["a"])(s.links),c=Object(_["a"])(s.nodes),d=g["g"](c).force("charge",g["f"]().strength(t.node_charge)).force("center",g["c"](n/2,o/2)).force("collide",g["d"]().radius((function(t){return-100*t.r}))).force("link",g["e"](a).id((function(t){return t.id})).distance(t.distance_nodes).strength(1)).on("tick",b);this.graphLayout=d;var l=[];s.links.forEach((function(t){l[t.source.index+"-"+t.target.index]=!0,l[t.target.index+"-"+t.source.index]=!0}));e=g["l"]("#viz").attr("width",n).attr("height",o);var u=g["l"]("#container");e.call(g["n"]().scaleExtent([.1,4]).on("zoom",(function(){u.attr("transform",g["b"].transform)})));var h=g["l"]("#g_nodes").selectAll("g").data(t.graph.nodes).enter();this.total_links=Object(_["a"])(this.total_links_2);var p=h.append("circle").attr("class","node").attr("r",(function(t){return 3*Math.pow(t.cdpScore,.5)})).attr("fill","white").attr("stroke",(function(t){return r(t.group)})),f=p;console.log(f);var v=g["l"]("#g_links").selectAll("line").data(Object(_["a"])(s.links)).enter().append("line").attr("class","link").attr("stroke","#aaa").attr("stroke-width","1px"),m=h.append("text").attr("class","text_circle").attr("text-anchor","middle").text((function(t,e){return t.title+"\n"+t.group})).style("fill",(function(t){return r(t.group)})).style("white-space","nowrap").style("overflow","hidden").style("font-family","Arial").style("font-size","5px").style("pointer-events","none");p.on("mouseover",(function(e){x(e),t.hover_node=!0,t.hovered_node=e})).on("mouseout",w)}function y(t,e){return t==e||l[t+"-"+e]}function b(){console.log("ticked"),m.call(O),p.call(j),v.call(C),d.nodes(t.graph.nodes),d.force("charge",g["f"]().strength(t.node_charge)).force("link",g["e"](s.links).id((function(t){return t.id})).distance(t.distance_nodes).strength(1)),t.current_x-=10}function k(t){return isFinite(t)?t:0}function x(t){var e=g["l"](g["b"].target).datum().index;p.style("opacity",(function(t){return y(e,t.index)?1:.1})),v.style("opacity",(function(t){return t.source.index==e||t.target.index==e?1:.1}))}function w(){p.style("opacity",1),v.style("opacity",1)}function C(t){t.attr("x1",(function(t){return k(t.source.x)})).attr("y1",(function(t){return k(t.source.y)})).attr("x2",(function(t){return k(t.target.x)})).attr("y2",(function(t){return k(t.target.y)}))}function j(t){t.attr("transform",(function(t){return"translate("+k(t.x)+","+k(t.y)+")"}))}function O(t){t.attr("transform",(function(t){return"translate("+k(t.x)+","+k(t.y)+")"}))}}}},E=N,D=(n("d776"),Object(l["a"])(E,k,x,!1,null,"63125e34",null)),A=D.exports,$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("custom-tooltip",{directives:[{name:"show",rawName:"v-show",value:null!==t.hovered_node,expression:"hovered_node !== null"}],attrs:{id:"infoBoxHolder",node_settings:t.node_settings,position:t.hovered_node_location,node:this.hovered_node},on:{favorite:t.setFavorite,trash:t.deleteNode}}),t.draw?n("tree-v2",{attrs:{node_charge:parseInt(t.node_charge),disp_titles:t.disp_titles,distance_nodes:parseInt(t.distance_nodes),adjlist:t.adjlist,graph_original:t.graph,cdpScore_threshold:parseInt(t.cdpScore_threshold),gradient_links:t.gradient_links},on:{hover_node:t.setHoveredNode}}):t._e(),n("div",{staticClass:"custom-container"},[n("b-row",{attrs:{"align-h":"end"}},[n("b-col",{attrs:{cols:"auto"}},[n("display-settings",{attrs:{dates_extrem:t.dates_extrem,dates_filter:t.dates_filter_array,fav_nodes:t.favorites,trash_nodes:t.trash},on:{charge:t.setCharge,disp_titles:t.setDispTitles,distance:t.setDistance,gradient_links:t.setGradientLinks,dates:t.setDates,key_words:t.setKeyWords,cdp:t.setCdp,favorites:t.setFavorites}})],1)],1)],1),n("b-modal",{attrs:{id:"delete-modal","hide-header":""}},[t._v("\n    Êtes vous sûrs de vouloir supprimer ce noeud ? Il sera déplacé dans la corbeille et pourra être restauré à tout moment.\n  ")])],1)},L=[],T=(n("28a5"),n("20d6"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"inputs_group"},[n("b-col",{staticClass:"custom-btn text-right",attrs:{cols:"12"}},[n("font-awesome-icon",{staticClass:"svg_icon",attrs:{icon:"cog"},on:{mouseleave:t.reduceSettings,mouseenter:t.displaySettings}})],1),n("b-col",{staticClass:"sliders display",attrs:{cols:"auto"}},[t._v("\n      Charge : "+t._s(t.node_charge)+"\n      "),n("vue-slider",{staticClass:"slider",attrs:{tooltipPlacement:"bottom",direction:"rtl",min:-1e5,max:0,contained:!0},model:{value:t.node_charge,callback:function(e){t.node_charge=e},expression:"node_charge"}}),n("br"),t._v("\n      Distance : "+t._s(t.distance_nodes)+"\n      "),n("vue-slider",{staticClass:"slider",attrs:{min:0,max:1e3,contained:!0},model:{value:t.distance_nodes,callback:function(e){t.distance_nodes=e},expression:"distance_nodes"}}),n("br"),t._v("\n      Afficher les titres :\n      "),n("br"),n("toggle-button",{attrs:{color:t.mainColor},on:{change:function(e){return t.$emit("disp_titles",t.disp_titles)}},model:{value:t.disp_titles,callback:function(e){t.disp_titles=e},expression:"disp_titles"}}),n("br"),t._v("\n      Activer les dégradés pour les liens :\n      "),n("br"),n("toggle-button",{attrs:{color:t.mainColor},on:{change:function(e){return t.$emit("gradient_links",t.gradient_links)}},model:{value:t.gradient_links,callback:function(e){t.gradient_links=e},expression:"gradient_links"}}),n("br")],1)],1),n("div",{staticClass:"inputs_group"},[n("b-col",{staticClass:"custom-btn text-right",attrs:{cols:"12"}},[n("font-awesome-icon",{staticClass:"svg_icon",attrs:{icon:"filter"},on:{mouseleave:t.reduceSettings,mouseenter:t.displaySettings}})],1),n("b-col",{staticClass:"sliders filters",attrs:{cols:"auto"}},[t._v("\n      Cdp Score mini : "+t._s(t.cdpScore_threshold)+"\n      "),n("vue-slider",{staticClass:"slider",attrs:{tooltipPlacement:"bottom",min:0,max:200,contained:!0},on:{"drag-end":function(e){return t.$emit("cdp",t.cdpScore_threshold)}},model:{value:t.cdpScore_threshold,callback:function(e){t.cdpScore_threshold=e},expression:"cdpScore_threshold"}}),n("br"),t._v("\n      Dates limites :\n      "),t.dates_extrem.start<t.dates_extrem.end?n("vue-slider",{attrs:{min:t.dates_extrem.start,max:t.dates_extrem.end,value:t.dates_filter,contained:!0},on:{"drag-end":t.sendDates,change:t.changeDates}}):t._e(),n("br"),t._v("\n      Mots clés :\n      "),n("input",{attrs:{type:" text",value:""},on:{change:t.sendKeyWords}}),n("br"),t._v("\n      Favoris seulement :\n      "),n("br"),n("toggle-button",{attrs:{color:t.mainColor},on:{change:function(e){return t.$emit("favorites",t.favorites)}},model:{value:t.favorites,callback:function(e){t.favorites=e},expression:"favorites"}}),n("br")],1)],1),n("div",{staticClass:"inputs_group"},[n("b-col",{staticClass:"custom-btn text-right",attrs:{cols:"12"}},[n("font-awesome-icon",{staticClass:"svg_icon",attrs:{icon:"briefcase"},on:{mouseleave:t.reduceSettings,mouseenter:t.displaySettings}})],1),n("b-col",{staticClass:"sliders lists",attrs:{cols:"auto"}},[n("ul",[t._v("\n        Favoris\n        "),t._l(t.fav_nodes,(function(e){return n("li",[t._v("\n          "+t._s(e.title)+"\n        ")])}))],2),n("ul",[t._v("\n        Corbeille\n        "),t._l(t.trash_nodes,(function(e){return n("li",[t._v("\n          "+t._s(e.title)+"\n        ")])}))],2)])],1)])}),F=[],q=n("4971"),M=n.n(q),P=(n("3e39"),{name:"display-settings",props:{dates_filter:Array,dates_extrem:Object,fav_nodes:Array,trash_nodes:Array,key_word:String},components:{VueSlider:M.a},data:function(){return{width:"2em",height:"2em",hovered:!1,node_charge:-6e3,cdpScore_threshold:5,distance_nodes:150,dates_buffer:[],favorites:!1,disp_titles:!0,gradient_links:!0}},computed:{computed_style:function(){return{width:this.width,height:this.height}}},methods:{reduceSettings:function(){this.hovered=!1},displaySettings:function(){this.hovered=!0},updateNodes:function(){},hover:function(){this.hovered=!this.hovered},sendKeyWords:function(t){this.$emit("key_words",t.target.value)},changeDates:function(t){this.dates_buffer=t},sendDates:function(){this.$emit("dates",this.dates_buffer)}},watch:{node_charge:function(){this.$emit("charge",this.node_charge)},distance_nodes:function(){this.$emit("distance",this.distance_nodes)},dates_filter:function(){}}}),G=P,R=(n("6a33"),Object(l["a"])(G,T,F,!1,null,"17de8274",null)),z=R.exports,B={name:"graph-overlay",components:{TreeV2:b,CustomTooltip:I,DisplaySettings:z},props:{socket:Object},data:function(){return{trash:[],favorites:[],draw:!1,total_nodes:[],total_links:[],adjlist:{},graph:{nodes:[],links:[]},hovered_node:null,disp_titles:!0,gradient_links:!0,node_charge:-6e3,distance_nodes:100,key_words:[],dates_filter:null,cdpScore_threshold:5,favorites_only:!1,hovered_node_location:{F:-25,G:100},node_settings:{diameter:20}}},computed:{links_checker:function(){return this.total_links.filter((function(t){return t.source.constructor===String&&t.target.constructor===String})).length},dates_extrem:function(){var t=this.total_nodes.map((function(t){return parseInt(t.year)})).filter((function(t){return!isNaN(t)}));return{start:Math.min.apply(Math,Object(_["a"])(t)),end:Math.max.apply(Math,Object(_["a"])(t))}},dates_filter_array:function(){var t;return t=null===this.dates_filter?[this.dates_extrem.start,this.dates_extrem.end]:[this.dates_filter.start,this.dates_filter.end],t}},methods:{deleteNode:function(){var t=this;this.$bvModal.msgBoxConfirm("Êtes vous sûrs de vouloir supprimer ce noeud ?\n Il sera déplacé dans la corbeille et pourra être restauré à tout moment.",{size:"sm",buttonSize:"sm",okVariant:"danger",okTitle:"Supprmier",cancelTitle:"Annuler",footerClass:"p-2",hideHeader:!0,centered:!0}).then((function(e){if(e){console.log("delete"),t.trash.push(t.copyNestedObject(t.hovered_node)),console.log(t.total_nodes);var n=t.total_nodes.findIndex((function(e){return e.id==t.hovered_node.id}));t.total_nodes.splice(n,1),console.log("post thing",t.total_nodes),n=t.graph.nodes.findIndex((function(e){return e.id==t.hovered_node.id})),t.updateNodes(),t.hovered_node=null}})).catch((function(t){console.log(t)}))},setFavorite:function(t){var e=this,n=this;if(t)this.favorites.push(this.hovered_node);else{var o=this.favorites.findIndex((function(t){return e.hovered_node.id==t.id}));this.favorites.splice(o,1)}this.hovered_node.favorite=t,this.hovered_node=Object.assign({},this.hovered_node);var r=this.total_nodes.findIndex((function(t){return t.id==n.hovered_node.id}));this.total_nodes[r].favorite=t,r=this.graph.nodes.findIndex((function(t){return t.id==n.hovered_node.id})),this.graph.nodes[r].favorite=t},copyNestedObject:function(t){var e,n=this;switch(t){case null:return null;case void 0:return}n=this;var o=t.constructor;switch(o){case Number:return t;case Boolean:return t;case String:return t;case Array:e=[];for(var r=0;r<t.length;r++)e.push(n.copyNestedObject(t[r]));return e;case Object:e={};for(var s=Object.keys(t),i=0;i<s.length;i++)e[s[i]]=n.copyNestedObject(t[s[i]]);return e}},search:function(){this.$emit("search")},setHoveredNode:function(t){this.hovered_node=t},addNode:function(t){var e=this;t.id=t.paperId,t.color="white",t.references.forEach((function(n){if(e.total_nodes.map((function(t){return t.id})).includes(n.paperId)){var o={source:n.paperId,target:t.paperId,value:1};e.total_links.includes(o)||e.total_links.push(o)}})),t.citations.forEach((function(n){if(e.total_nodes.map((function(t){return t.key})).includes(n.paperId)){var o={source:t.paperId,target:n.paperId,value:1};e.total_links.includes(o)||e.total_links.push(o)}})),t.id=t.paperId,t.group=Math.round(t.citations.length/100),e.total_nodes.map((function(t){return t.paperId})).includes(t.paperId)||null==t.paperId||void 0===t.paperId||e.total_nodes.push(t)},computeEventual_nodes:function(){var t=this,e=this,n=this.total_nodes.filter((function(n){var o=!0,r=!0,s=!0;if(t.favorites_only&&!n.favorite&&(o=!1),null===e.dates_filter||e.dates_filter.end>=n.year&&e.dates_filter.start<=n.year||(console.log(n.year),console.log(e.dates_filter),console.log("Dates are fitlersd"),s=!1),t.key_words.length>0){r=!1;for(var i=0;i<t.key_words.length;i++)if(n.title.toUpperCase().includes(t.key_words[i].toUpperCase())){r=!0;break}}return s&&r&&o&&n.cdpScore>=t.cdpScore_threshold}));return n},computeEventual_links:function(t){for(var e=this,n=this.copyNestedObject(e.total_links).filter((function(e){return t.map((function(t){return t.paperId})).includes(e.source)&&t.map((function(t){return t.paperId})).includes(e.target)})),r=0;r<n.length;r++)e.adjlist[n[r].source+"-"+n[r].target]=!0,e.adjlist[n[r].target+"-"+n[r].source]=!0;return o["default"].set(e,"adjlist",e.adjlist),n},addCircle:function(){this.graph.nodes.push({id:"45454545454",cdpScore:124,title:"qsdmlkj",x:this.graph.nodes[0].x,y:this.graph.nodes[0].y,citations:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]})},updateNodes:function(){console.log("Update nodes");var t=this,e=Object(_["a"])(this.computeEventual_nodes());console.log("Updated nodes");var n=Object(_["a"])(this.computeEventual_links(e));console.log("Updated links"),o["default"].set(t.graph,"nodes",e),o["default"].set(t.graph,"links",n)},setCharge:function(t){this.node_charge=t},setCdp:function(t){this.cdpScore_threshold=t,this.updateNodes()},setDistance:function(t){this.distance_nodes=t},setFavorites:function(t){console.log("Je veux set les favoris : ",t),this.favorites_only=t,this.updateNodes()},setDispTitles:function(t){this.disp_titles=t},setKeyWords:function(t){console.log("the"+t+"string"),this.key_words=""===t?[]:Object(_["a"])(t.split(" ")),console.log(this.key_words),this.updateNodes()},setDates:function(t){this.dates_filter={start:t[0],end:t[1]},this.updateNodes()},setGradientLinks:function(t){console.log("NOT GRADIENT"),this.gradient_links=t}},mounted:function(){var t=this,e=this;setTimeout((function(){e.updateNodes(),e.draw=!0}),3e3);e=this;console.log("Launching stuff"),this.socket.on("done",(function(){console.log("RECEIVED ALL")})),this.socket.on("new_node",(function(e){t.addNode(e)}))}},H=B,U=(n("a70f"),Object(l["a"])(H,$,L,!1,null,"7e84be7e",null)),W=U.exports,V={name:"app",components:{CrashPage:h,TreeV2:b,GraphOverlay:W,TreeD3:A},data:function(){return{step:0,socket:null,data:[]}},methods:{search:function(){this.step=0},draw_graph:function(t){this.step=1,this.data=t.data,this.socket=t.socket}}},J=V,K=(n("034f"),Object(l["a"])(J,r,s,!1,null,null,null)),Y=K.exports,X=n("5f5b"),Q=n("bc3a"),Z=n.n(Q),tt=n("a7fe"),et=n.n(tt),nt=n("ad3d"),ot=n("8e5f"),rt=n.n(ot),st=n("f206"),it=n.n(st),at=(n("6f70"),n("8055")),ct=n.n(at),dt=n("ecee"),lt=n("c074");n("f9e3"),n("2dd8"),n("c2c5"),n("e607");o["default"].prototype.$socketIO=ct.a,o["default"].prototype.mainColor="#2c3e50",o["default"].prototype.interestColor="#FDDC17",o["default"].prototype.lightColor="rgb(150,150,150)",o["default"].prototype.redColor="#ff6a6a",o["default"].prototype.greenColor="#41B883",dt["c"].add(lt["d"]),dt["c"].add(lt["b"]),dt["c"].add(lt["c"]),dt["c"].add(lt["e"]),dt["c"].add(lt["a"]),dt["c"].add(lt["f"]),o["default"].use(it.a),o["default"].component("vue-multiselect",rt.a),o["default"].use(et.a,Z.a),o["default"].prototype.$=Z.a,o["default"].use(X["a"]),o["default"].component("font-awesome-icon",nt["a"]),o["default"].config.productionTip=!1,new o["default"]({render:function(t){return t(Y)}}).$mount("#app")},"64a9":function(t,e,n){},"6a33":function(t,e,n){"use strict";var o=n("31cd"),r=n.n(o);r.a},"71dd":function(t,e,n){},"73fe":function(t,e,n){},"7baa":function(t,e,n){},a18d:function(t,e,n){},a70f:function(t,e,n){"use strict";var o=n("71dd"),r=n.n(o);r.a},c2c5:function(t,e,n){},cb2b:function(t,e,n){"use strict";var o=n("73fe"),r=n.n(o);r.a},d776:function(t,e,n){"use strict";var o=n("a18d"),r=n.n(o);r.a},d887:function(t,e,n){"use strict";var o=n("2f4e"),r=n.n(o);r.a},dafa:function(t,e,n){"use strict";var o=n("7baa"),r=n.n(o);r.a}});
//# sourceMappingURL=app.15eee0cb.js.map